---
import PageLayout from '../layouts/PageLayout.astro';
---

<PageLayout title="Vivencias - H√©roes de la Fe">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

  <div class="main-container">
    <header style="text-align:center; padding: 40px 0;">
      <h1 class="title">Mi Amigo Anhelado</h1>
      <p class="subtitle">Historias que Transforman</p>
    </header>

    <div id="loader" style="text-align:center; color: var(--primary);">Cargando historias...</div>

    <div id="hero-gallery" style="display:none;">
      </div>

    <div class="nav-actions">
      <button onclick="window.prev()" class="btn-nav">‚Üê Anterior</button>
      <button onclick="window.next()" class="btn-nav">Siguiente ‚Üí</button>
    </div>
  </div>

  <style is:inline>
    :root { --primary: #1a4d2e; --accent: #d4a574; --bg: #faf8f5; --text: #2c3e50; }
    
    .main-container { width: 100%; max-width: 650px; margin: 0 auto; padding: 20px; font-family: 'Crimson Text', serif; }
    .title { font-family: 'Playfair Display', serif; font-size: 2.8rem; color: var(--primary); margin: 0; }
    .subtitle { color: var(--accent); font-weight: bold; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 3px; }
    
    .card {
      background: white; border-radius: 25px; padding: 40px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.08);
      border-top: 12px solid var(--primary);
      animation: slideUp 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .badge-tema {
      background: rgba(212, 165, 116, 0.15); color: var(--accent);
      padding: 6px 18px; border-radius: 50px; font-weight: bold; font-size: 0.9rem;
    }

    .historia-txt { font-size: 1.35rem; line-height: 1.8; color: var(--text); margin: 30px 0; text-align: justify; }

    /* Estilo para los vers√≠culos m√∫ltiples */
    .palabra-box { background: #fdfaf6; padding: 25px; border-radius: 20px; border: 1px solid #f1ece4; margin-bottom: 30px; }
    .palabra-item { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid rgba(212, 165, 116, 0.2); }
    .palabra-item:last-child { margin-bottom: 0; padding-bottom: 0; border: none; }
    .v-texto { font-style: italic; font-size: 1.3rem; color: var(--primary); display: block; margin-bottom: 5px; }
    .v-ref { font-weight: bold; color: var(--accent); font-size: 0.9rem; text-transform: uppercase; }

    .oracion-box {
      background: var(--primary); color: white; padding: 30px; border-radius: 20px;
      box-shadow: 0 10px 20px rgba(26, 77, 46, 0.15);
    }
    .oracion-box h4 { color: var(--accent); margin: 0 0 10px 0; letter-spacing: 1px; }

    .nav-actions { display: flex; gap: 20px; margin-top: 40px; }
    .btn-nav {
      flex: 1; padding: 18px; border-radius: 50px; border: none;
      background: white; color: var(--primary); font-weight: bold; font-size: 1rem;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05); cursor: pointer; transition: 0.3s;
    }
    .btn-nav:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }

    @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } }
  </style>

  <script is:inline>
    // URL de su GitHub (Aseg√∫rese de que el JSON tenga el formato del array [{},{}])
    const GITHUB_URL = "https://raw.githubusercontent.com/jair2471-blip/vivenciasbiblicas/main/vivencias-biblia.json";
    
    let vivencias = [];
    let currentIdx = 0;

    async function init() {
      try {
        const response = await fetch(GITHUB_URL);
        vivencias = await response.json();
        
        document.getElementById('loader').style.display = 'none';
        document.getElementById('hero-gallery').style.display = 'block';
        
        render();
      } catch (error) {
        console.error("Error al orbitar los datos:", error);
        document.getElementById('loader').innerText = "‚ùå No pudimos conectar con los datos en GitHub.";
      }
    }

    function render() {
      const v = vivencias[currentIdx];
      const container = document.getElementById('hero-gallery');
      
      // Mapeamos los vers√≠culos del array "palabra"
      const palabrasHTML = v.palabra.map(p => `
        <div class="palabra-item">
          <span class="v-texto">"${p.texto}"</span>
          <span class="v-ref">${p.referencia}</span>
        </div>
      `).join('');

      container.innerHTML = `
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:flex-start;">
            <h2 style="font-family:'Playfair Display'; margin:0; font-size:2.8rem; color:var(--primary); line-height:1;">${v.personaje}</h2>
            <span class="badge-tema">${v.tema}</span>
          </div>
          
          <p class="historia-txt">${v.historia}</p>

          <div class="palabra-box">
            <h4 style="margin:0 0 15px 0; color:var(--accent); font-size:0.8rem; letter-spacing:2px;">ESCRITURAS CLAVE</h4>
            ${palabrasHTML}
          </div>

          <div class="oracion-box">
            <h4>üôè ORACI√ìN</h4>
            <p style="margin:0; font-size:1.15rem; line-height:1.6; font-style: italic;">${v.oracion}</p>
          </div>
        </div>
      `;
    }

    window.next = () => { currentIdx = (currentIdx + 1) % vivencias.length; render(); window.scrollTo({top:0, behavior:'smooth'}); }
    window.prev = () => { currentIdx = (currentIdx - 1 + vivencias.length) % vivencias.length; render(); window.scrollTo({top:0, behavior:'smooth'}); }

    init();
  </script>
</PageLayout>
